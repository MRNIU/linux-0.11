<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>linux: /home/runner/work/linux-0.11/linux-0.11/src/kernel/math/math_emulate.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">linux
   &#160;<span id="projectnumber">0.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('src_2kernel_2math_2math__emulate_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">math_emulate.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;linux/sched.h&gt;</code><br />
<code>#include &lt;linux/kernel.h&gt;</code><br />
<code>#include &lt;asm/segment.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for math_emulate.c:</div>
<div class="dyncontent">
<div class="center"><img src="src_2kernel_2math_2math__emulate_8c__incl.png" border="0" usemap="#a_2home_2runner_2work_2linux-0_811_2linux-0_811_2src_2kernel_2math_2math__emulate_8c" alt=""/></div>
<map name="a_2home_2runner_2work_2linux-0_811_2linux-0_811_2src_2kernel_2math_2math__emulate_8c" id="a_2home_2runner_2work_2linux-0_811_2linux-0_811_2src_2kernel_2math_2math__emulate_8c">
<area shape="rect" title=" " alt="" coords="128,5,319,61"/>
<area shape="rect" title=" " alt="" coords="5,109,79,136"/>
<area shape="rect" title=" " alt="" coords="103,109,211,136"/>
<area shape="rect" title=" " alt="" coords="235,109,345,136"/>
<area shape="rect" title=" " alt="" coords="370,109,493,136"/>
</map>
</div>
</div>
<p><a href="src_2kernel_2math_2math__emulate_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6921995b5790cbfb7c0a6374321216bf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="src_2kernel_2math_2math__emulate_8c.html#a6921995b5790cbfb7c0a6374321216bf">math_emulate</a> (long edi, long esi, long ebp, long sys_call_ret, long eax, long ebx, long ecx, long edx, unsigned short fs, unsigned short es, unsigned short ds, unsigned long eip, unsigned short cs, unsigned long eflags, unsigned short ss, unsigned long esp)</td></tr>
<tr class="separator:a6921995b5790cbfb7c0a6374321216bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a907b39e81b197f885244ad8e87942750"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="src_2kernel_2math_2math__emulate_8c.html#a907b39e81b197f885244ad8e87942750">math_error</a> (void)</td></tr>
<tr class="separator:a907b39e81b197f885244ad8e87942750"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6921995b5790cbfb7c0a6374321216bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6921995b5790cbfb7c0a6374321216bf">&#9670;&nbsp;</a></span>math_emulate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void math_emulate </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>edi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>esi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ebp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>sys_call_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>eax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ebx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>ecx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>edx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>es</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>ds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>eip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>cs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>eflags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>ss</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>esp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="src_2kernel_2math_2math__emulate_8c_source.html#l00020">20</a> of file <a class="el" href="src_2kernel_2math_2math__emulate_8c_source.html">math_emulate.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;{</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> first, second;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">// 0x0007 means user code space 表示用户代码空间</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">// 选择符 0x000F 表示在局部描述符表中描述符索引值=1，即代码空间。如果段寄存器 cs 不等于 0x000F，</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// 则表示 cs 一定是内核代码选择符，是在内核代码空间，则出错，显示此时的 cs:eip 值，并显示</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// 信息“内核中需要数学仿真”，然后进入死机状态</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (cs != 0x000F) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <a class="code" href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#a929c48d2c61fe71be34a9cdf0ab04fcc">printk</a>(<span class="stringliteral">&quot;math_emulate: %04x:%08x\n\r&quot;</span>,cs,eip);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <a class="code" href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#ab43c5eded9a063f60e583332eaa73258">panic</a>(<span class="stringliteral">&quot;Math emulation needed in kernel&quot;</span>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// 取进程 cs,eip 指向的 2 字节代码 first 和 secind,显示这些数据，并给进程设置浮点异常信号 SIGFPE</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    first = <a class="code" href="flash_2Linux-0_811_2include_2asm_2segment_8h.html#a5f273be4f36ebf76067d04592954aaf4">get_fs_byte</a>((<span class="keywordtype">char</span> *)((*&amp;eip)++));</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    second = <a class="code" href="flash_2Linux-0_811_2include_2asm_2segment_8h.html#a5f273be4f36ebf76067d04592954aaf4">get_fs_byte</a>((<span class="keywordtype">char</span> *)((*&amp;eip)++));</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#a929c48d2c61fe71be34a9cdf0ab04fcc">printk</a>(<span class="stringliteral">&quot;%04x:%08x %02x %02x\n\r&quot;</span>,cs,eip-2,first,second);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="flash_2Linux-0_811_2include_2linux_2sched_8h.html#a476ec09a598028a09942c2233aa5127e">current</a>-&gt;<a class="code" href="structtask__struct.html#a52bf129480ad1720d6672e94a8736b56">signal</a> |= 1&lt;&lt;(<a class="code" href="flash_2Linux-0_811_2include_2signal_8h.html#a7fbba29aec3e4a8daae12935299df92d">SIGFPE</a>-1);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2asm_2segment_8h_html_a5f273be4f36ebf76067d04592954aaf4"><div class="ttname"><a href="flash_2Linux-0_811_2include_2asm_2segment_8h.html#a5f273be4f36ebf76067d04592954aaf4">get_fs_byte</a></div><div class="ttdeci">static unsigned char get_fs_byte(const char *addr)</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2include_2asm_2segment_8h_source.html#l00001">segment.h:1</a></div></div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2linux_2kernel_8h_html_a929c48d2c61fe71be34a9cdf0ab04fcc"><div class="ttname"><a href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#a929c48d2c61fe71be34a9cdf0ab04fcc">printk</a></div><div class="ttdeci">int printk(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2kernel_2printk_8c_source.html#l00021">printk.c:21</a></div></div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2linux_2kernel_8h_html_ab43c5eded9a063f60e583332eaa73258"><div class="ttname"><a href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#ab43c5eded9a063f60e583332eaa73258">panic</a></div><div class="ttdeci">volatile void panic(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2kernel_2panic_8c_source.html#l00018">panic.c:18</a></div></div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2linux_2sched_8h_html_a476ec09a598028a09942c2233aa5127e"><div class="ttname"><a href="flash_2Linux-0_811_2include_2linux_2sched_8h.html#a476ec09a598028a09942c2233aa5127e">current</a></div><div class="ttdeci">struct task_struct * current</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2kernel_2sched_8c_source.html#l00062">sched.c:62</a></div></div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2signal_8h_html_a7fbba29aec3e4a8daae12935299df92d"><div class="ttname"><a href="flash_2Linux-0_811_2include_2signal_8h.html#a7fbba29aec3e4a8daae12935299df92d">SIGFPE</a></div><div class="ttdeci">#define SIGFPE</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2include_2signal_8h_source.html#l00020">signal.h:20</a></div></div>
<div class="ttc" id="astructtask__struct_html_a52bf129480ad1720d6672e94a8736b56"><div class="ttname"><a href="structtask__struct.html#a52bf129480ad1720d6672e94a8736b56">task_struct::signal</a></div><div class="ttdeci">long signal</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2include_2linux_2sched_8h_source.html#l00085">sched.h:85</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="src_2kernel_2math_2math__emulate_8c_a6921995b5790cbfb7c0a6374321216bf_cgraph.png" border="0" usemap="#asrc_2kernel_2math_2math__emulate_8c_a6921995b5790cbfb7c0a6374321216bf_cgraph" alt=""/></div>
<map name="asrc_2kernel_2math_2math__emulate_8c_a6921995b5790cbfb7c0a6374321216bf_cgraph" id="asrc_2kernel_2math_2math__emulate_8c_a6921995b5790cbfb7c0a6374321216bf_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,123,83"/>
<area shape="rect" href="flash_2Linux-0_811_2include_2asm_2segment_8h.html#a5f273be4f36ebf76067d04592954aaf4" title=" " alt="" coords="171,5,269,32"/>
<area shape="rect" href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#ab43c5eded9a063f60e583332eaa73258" title=" " alt="" coords="191,107,249,133"/>
<area shape="rect" href="flash_2Linux-0_811_2include_2linux_2kernel_8h.html#a929c48d2c61fe71be34a9cdf0ab04fcc" title=" " alt="" coords="328,56,388,83"/>
<area shape="rect" href="flash_2Linux-0_811_2kernel_2panic_8c.html#acc81aedafa96378bafb37b5bccbccb20" title=" " alt="" coords="317,107,399,133"/>
<area shape="rect" href="flash_2Linux-0_811_2kernel_2printk_8c.html#aaa83f2a89dae6d03dfe15deae29f383a" title=" " alt="" coords="447,56,519,83"/>
<area shape="rect" href="flash_2Linux-0_811_2kernel_2vsprintf_8c.html#ac2f4c669c6f6aa6caa5ab8adb1b07dd0" title=" " alt="" coords="571,5,643,32"/>
<area shape="rect" href="flash_2Linux-0_811_2kernel_2vsprintf_8c.html#a3fa7c8ef8597579301cb4b5c59bc6d9a" title=" " alt="" coords="567,56,648,83"/>
<area shape="rect" href="flash_2Linux-0_811_2include_2string_8h.html#a2dee044e4e667b5b789b493abd21cfa4" title=" " alt="" coords="578,107,637,133"/>
</map>
</div>

</div>
</div>
<a id="a907b39e81b197f885244ad8e87942750"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a907b39e81b197f885244ad8e87942750">&#9670;&nbsp;</a></span>math_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void math_error </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="src_2kernel_2math_2math__emulate_8c_source.html#l00044">44</a> of file <a class="el" href="src_2kernel_2math_2math__emulate_8c_source.html">math_emulate.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;{</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">// 协处理器指令。(以非等待形式)清除所有异常标志、忙标志和状态字位 7</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    __asm__(<span class="stringliteral">&quot;fnclex&quot;</span>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// 如果上个任务使用过协处理器，则向上个任务发送协处理器异常信号</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="flash_2Linux-0_811_2include_2linux_2sched_8h.html#a4a720faae9986c1917541956019c8a3b">last_task_used_math</a>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="flash_2Linux-0_811_2include_2linux_2sched_8h.html#a4a720faae9986c1917541956019c8a3b">last_task_used_math</a>-&gt;<a class="code" href="structtask__struct.html#a52bf129480ad1720d6672e94a8736b56">signal</a> |= 1&lt;&lt;(<a class="code" href="flash_2Linux-0_811_2include_2signal_8h.html#a7fbba29aec3e4a8daae12935299df92d">SIGFPE</a>-1);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="ttc" id="aflash_2Linux-0_811_2include_2linux_2sched_8h_html_a4a720faae9986c1917541956019c8a3b"><div class="ttname"><a href="flash_2Linux-0_811_2include_2linux_2sched_8h.html#a4a720faae9986c1917541956019c8a3b">last_task_used_math</a></div><div class="ttdeci">struct task_struct * last_task_used_math</div><div class="ttdef"><b>Definition:</b> <a href="flash_2Linux-0_811_2kernel_2sched_8c_source.html#l00063">sched.c:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cbd7f246bdf7dc0a50281a272327e6ed.html">kernel</a></li><li class="navelem"><a class="el" href="dir_4017e855267c95e8360f0c3deb2acb14.html">math</a></li><li class="navelem"><a class="el" href="src_2kernel_2math_2math__emulate_8c.html">math_emulate.c</a></li>
    <li class="footer">Generated on Wed Sep 13 2023 00:50:58 for linux by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
